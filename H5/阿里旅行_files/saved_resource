KISSY.add("h5-member/widgets/activate-util/index",function(e,t,a){"use strict";var i,r,n,o,c=/(FAIL_SYS_SESSION_EXPIRED|FAIL_SYS_TOKEN_EXOIRED|NEED_LOGIN::|NOT_FOUNT_USER::|-100::|ERR_SID_INVALID::|SID_ERROR::)/i,s=location.pathname.replace("/trip/",""),l=s.replace(/\//g,"-").split(".")[0],m=(s.split("/")[0],"ActivateMemberInfo");return{init:function(e){o=e||"default",i=a.locStorage.get(m),i?(i=JSON.parse(i),t.getNick().then(function(e){n=e,n&&n in i&&(r=i[n])})):i={}},getActivateInfo:function(){return r},getPagePath:function(){return l},getChannelName:function(){var t="default",a=["flight","inn","hotel","train","ticket","holiday","visa"];return e.each(a,function(e){return-1!=l.indexOf(e)?(t=e,!1):void 0}),t},procActivate:function(e,a,i){var r=this,n=r.getEnv();t.isLogin()&&r.detectActive(function(e){},function(t){r.detectUICdata(function(t){e?location.href="http://"+n+".taobao.com/trip/h5-act612/passenger/detail.html?pAction=update&backUrl="+encodeURIComponent(location.href)+"&passengerName="+t.data.name+"&phoneNumber="+t.data.phone:i(t)},function(t){e&&(location.href="http://"+n+".taobao.com/trip/h5-act612/pages/passenger/detail.html?pAction=add&backUrl="+encodeURIComponent(location.href))})},a)},detectActive:function(e,a,i){var r=this,n={hasDetail:"0",hasPoint:"0"};i=!(i===!1);var o=function(t){var n=t.ret[0];n&&n.match(/SUCCESS/gim)?"1"==t.data.isActive?e&&e(t):a&&a(t):i&&c.test(n)&&r.login()},s=function(e){var t=e.ret[0];i&&c.test(t)&&r.login()};t.getApi("mtop.trip.common.getUserFfaInfo","1.0",n,{needLogin:!0},o,s)},detectUICdata:function(a,i){var r={},n=function(t){e.log(t),t.ret&&t.ret[0].match(/SUCCESS/gim)?a&&a(t):i&&i()},o=function(e){};t.getApi("mtop.trip.common.getAlipayIdCard","1.0",r,{needLogin:!0},n,o)},activateUser:function(e,r,o,s){var l=this,d=function(t){if("[object Array]"===Object.prototype.toString.call(t.ret)&&1===t.ret.length){var r=t.ret[0];/SUCCESS/.test(r)&&1==Number(t.data.isSuccess)||/HAS_ACTIVATED/.test(r)?(i[n]={activated:!0,nickName:n,realName:e.name},a.locStorage.set(m,JSON.stringify(i)),o&&o(t)):c.test(r)?l.login():s&&s(t)}},u=function(e){s&&s(e)},p=function(){var e=location.search.match(/ttid=([^&]+)/);return e?e[1]:"201300@travel_h5_3.1.0"};e.channel=r,t.getApi("mtop.trip.common.activateUser","1.0",e,{ttid:p(),needLogin:!0},d,u)},detectFillInfoBack:function(e,t){var i=this,r=a.locStorage.get("act612.passenger.detail");if(r){a.locStorage.removeItem("act612.passenger.detail");var n=JSON.parse(r),o={name:n.passengerName,certType:n.certTypeCode,phone:n.phoneNumber,certNumber:n.certNumber};i.activateUser(o,e,t)}},getEnv:function(){var e=location.href,t="h5.m";return t=/waptest/.test(e)?"wapp.waptest":/wapa/.test(e)?"wapp.wapa":"h5.m"},login:function(){t.goLogin()}}},{requires:["mtop","../../widgets/util/"]});KISSY.add("h5-member/mods/activate-name-pop/active-data",function(e,a){return a.extend({initializer:function(){var e=this;e.on("*Change",function(a){e.fire("activeDataChange",a)})}},{ATTRS:{certificated:{value:!1},joinBtnText:{value:"\u7acb\u5373\u52a0\u5165"},nickName:{value:""},realName:{value:""},awardMileage:{value:"-"},successJoinText:{value:"\u77e5\u9053\u4e86"},onInput:{value:!1},nameValid:{value:!1},nameValidMessage:{value:""},showNameValidMessage:{value:!1},reasonText:{value:"\u4eb2\uff0c\u62b1\u6b49\u7f51\u7edc\u8fde\u63a5\u6545\u969c\u6216\u670d\u52a1\u5668\u5f00\u5c0f\u5dee\u4e86!"},suggestText:{value:"\u8bf7\u68c0\u67e5\u7f51\u7edc\u8fde\u63a5\u6216\u7a0d\u5019\u518d\u91cd\u8bd5!"},needRetry:{value:!0},activateSuccess:{value:null}}})},{requires:["base"]});